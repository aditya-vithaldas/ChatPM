<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DecisionOS - One Stop Shop for Product Managers</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #6366f1; --primary-dark: #4f46e5; --primary-light: #818cf8;
            --accent: #f97316; --accent-light: #fb923c;
            --sidebar-bg: #0f172a; --sidebar-hover: #1e293b;
            --text-primary: #f8fafc; --text-secondary: #94a3b8; --text-muted: #64748b;
            --bg-main: #f1f5f9; --bg-card: #ffffff; --border-color: #e2e8f0;
            --success: #22c55e; --error: #ef4444; --info: #3b82f6; --warning: #f59e0b;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f97316 0%, #ec4899 100%);
            --gradient-3: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg-main); color: #1e293b; line-height: 1.6; display: flex; min-height: 100vh; }

        /* Login Screen */
        .login-screen {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
            display: flex; align-items: flex-start; justify-content: center; z-index: 1000;
            overflow-y: auto; overflow-x: hidden;
        }
        .login-screen.hidden { display: none; }

        .login-bg-shapes {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; overflow: hidden; pointer-events: none;
        }
        .login-bg-shapes::before {
            content: ''; position: absolute; width: 600px; height: 600px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.15) 0%, transparent 70%);
            top: -200px; right: -200px; border-radius: 50%;
        }
        .login-bg-shapes::after {
            content: ''; position: absolute; width: 500px; height: 500px;
            background: radial-gradient(circle, rgba(249, 115, 22, 0.12) 0%, transparent 70%);
            bottom: -150px; left: -150px; border-radius: 50%;
        }

        .login-container { display: flex; width: 100%; max-width: 1200px; min-height: 600px; position: relative; z-index: 1; }

        .login-branding {
            flex: 1; padding: 60px; display: flex; flex-direction: column; justify-content: center;
            color: white;
        }
        .login-branding h1 {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 3.5rem; font-weight: 800; line-height: 1.1; margin-bottom: 24px;
            background: linear-gradient(135deg, #ffffff 0%, #c7d2fe 50%, #f97316 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .login-branding p { font-size: 1.1rem; color: #94a3b8; max-width: 400px; line-height: 1.7; }
        .login-features { margin-top: 48px; display: grid; gap: 16px; }
        .login-feature { display: flex; align-items: center; gap: 12px; color: #cbd5e1; font-size: 0.95rem; }
        .login-feature-icon {
            width: 32px; height: 32px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px;
        }
        .login-feature:nth-child(1) .login-feature-icon { background: rgba(99, 102, 241, 0.2); }
        .login-feature:nth-child(2) .login-feature-icon { background: rgba(249, 115, 22, 0.2); }
        .login-feature:nth-child(3) .login-feature-icon { background: rgba(34, 197, 94, 0.2); }
        .login-feature:nth-child(4) .login-feature-icon { background: rgba(6, 182, 212, 0.2); }

        .login-card {
            width: 420px; background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px; padding: 48px; margin: 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }
        .login-card-header { text-align: center; margin-bottom: 40px; }
        .login-logo {
            width: 64px; height: 64px; margin: 0 auto 20px;
            background: var(--gradient-2); border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            font-size: 28px; box-shadow: 0 8px 24px rgba(249, 115, 22, 0.3);
        }
        .login-card-title {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 8px;
        }
        .login-card-subtitle { color: #94a3b8; font-size: 0.9rem; }

        .google-btn {
            display: flex; align-items: center; justify-content: center; gap: 12px;
            width: 100%; padding: 16px 24px;
            background: white; border: none; border-radius: 12px;
            font-size: 1rem; font-weight: 600; cursor: pointer;
            transition: all 0.3s; font-family: 'Plus Jakarta Sans', sans-serif;
            color: #1e293b;
        }
        .google-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
        }
        .google-btn svg { width: 20px; height: 20px; }

        .login-divider { display: flex; align-items: center; gap: 16px; margin: 28px 0; color: #64748b; font-size: 0.8rem; }
        .login-divider::before, .login-divider::after { content: ''; flex: 1; height: 1px; background: rgba(255,255,255,0.1); }

        .login-footer { text-align: center; color: #64748b; font-size: 0.8rem; margin-top: 24px; }
        .login-footer a { color: var(--primary-light); text-decoration: none; }

        /* User Menu */
        .user-menu { display: flex; align-items: center; gap: 12px; }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; border: 2px solid var(--border-color); }
        .user-name { font-weight: 500; font-size: 0.9rem; }
        .user-dropdown { position: relative; }
        .user-dropdown-btn { display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: var(--bg-main); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; font-size: 0.85rem; }
        .user-dropdown-btn:hover { background: var(--bg-card); }
        .user-dropdown-menu { position: absolute; top: 100%; right: 0; margin-top: 8px; background: white; border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: none; min-width: 150px; z-index: 100; }
        .user-dropdown-menu.show { display: block; }
        .user-dropdown-item { padding: 10px 16px; cursor: pointer; font-size: 0.85rem; }
        .user-dropdown-item:hover { background: var(--bg-main); }
        .user-dropdown-item.danger { color: var(--error); }

        .sidebar { width: 280px; background: var(--sidebar-bg); color: var(--text-primary); display: flex; flex-direction: column; position: fixed; height: 100vh; z-index: 100; }
        .sidebar-header { padding: 24px 20px; border-bottom: 1px solid rgba(255,255,255,0.08); }
        .sidebar-logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon {
            width: 42px; height: 42px;
            background: var(--gradient-2);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-size: 20px; box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
        }
        .logo-text { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1.25rem; font-weight: 700; }
        .logo-subtitle { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }

        .sidebar-nav { flex: 1; padding: 20px 12px; overflow-y: auto; }
        .nav-section { margin-bottom: 24px; }
        .nav-section-title {
            font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.1em;
            color: var(--text-muted); padding: 8px 16px; font-weight: 600;
        }
        .nav-item {
            display: flex; align-items: center; gap: 12px; padding: 12px 16px;
            border-radius: 10px; cursor: pointer; transition: all 0.2s; margin-bottom: 4px;
            color: var(--text-secondary); text-decoration: none; font-size: 0.9rem; font-weight: 500;
        }
        .nav-item:hover { background: var(--sidebar-hover); color: var(--text-primary); }
        .nav-item.active { background: var(--primary); color: white; }
        .nav-item.disabled { opacity: 0.4; cursor: not-allowed; }
        .nav-item.coming-soon { opacity: 0.5; }
        .nav-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .nav-badge { margin-left: auto; background: var(--success); color: white; font-size: 0.6rem; padding: 2px 8px; border-radius: 10px; font-weight: 600; }
        .nav-badge.soon { background: var(--sidebar-hover); color: var(--text-muted); font-size: 0.55rem; }
        .nav-item-remove { margin-left: auto; opacity: 0; font-size: 12px; padding: 2px 6px; border-radius: 4px; }
        .nav-item:hover .nav-item-remove { opacity: 0.6; }
        .nav-item-remove:hover { opacity: 1 !important; background: rgba(255,255,255,0.1); }

        .connection-status { padding: 16px 20px; border-top: 1px solid rgba(255,255,255,0.08); }
        .status-indicator { display: flex; align-items: center; gap: 10px; font-size: 0.85rem; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--error); }
        .status-dot.connected { background: var(--success); box-shadow: 0 0 8px var(--success); }

        .main-content { flex: 1; margin-left: 280px; min-height: 100vh; }
        .top-bar {
            background: var(--bg-card); padding: 16px 32px;
            border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 50;
        }
        .page-title { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1.5rem; font-weight: 700; }
        .page-subtitle { font-size: 0.875rem; color: var(--text-muted); }
        .content-area { padding: 32px; }

        .panel { display: none; }
        .panel.active { display: block; }

        .card { background: var(--bg-card); border-radius: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); padding: 24px; margin-bottom: 24px; border: 1px solid var(--border-color); }
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .card-title { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1.1rem; font-weight: 600; }

        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; font-size: 0.9rem; }
        .form-input { width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 10px; font-size: 0.95rem; font-family: inherit; transition: border-color 0.2s; }
        .form-input:focus { outline: none; border-color: var(--primary); }
        .form-input.code { font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem; }

        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; border: none; border-radius: 10px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; font-family: 'Plus Jakarta Sans', sans-serif; }
        .btn-primary { background: var(--gradient-1); color: white; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(99,102,241,0.4); }
        .btn-secondary { background: var(--bg-main); color: #374151; border: 1px solid var(--border-color); }
        .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
        .btn-lg { padding: 14px 28px; font-size: 1rem; }

        .alert { padding: 14px 18px; border-radius: 10px; margin-bottom: 20px; font-size: 0.9rem; }
        .alert-success { background: #dcfce7; color: #166534; }
        .alert-error { background: #fee2e2; color: #991b1b; }
        .alert-info { background: #dbeafe; color: #1e40af; }
        .alert-warning { background: #fef3c7; color: #92400e; }

        .examples-grid { display: grid; gap: 12px; margin-top: 16px; }
        .example-item { background: var(--bg-main); padding: 14px 18px; border-radius: 10px; font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem; color: #475569; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
        .example-item:hover { border-color: var(--primary); background: #ede9fe; }
        .example-label { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px; font-weight: 600; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .stat-card { background: white; padding: 24px; border-radius: 16px; border: 1px solid var(--border-color); }
        .stat-value { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 2.5rem; font-weight: 700; background: var(--gradient-1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .stat-label { font-size: 0.85rem; color: var(--text-muted); font-weight: 500; }

        .table-list { display: grid; gap: 12px; }
        .table-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; overflow: hidden; }
        .table-header { padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; background: #fafafa; transition: background 0.2s; }
        .table-header:hover { background: #f5f5f5; }
        .table-name { font-weight: 600; font-size: 0.95rem; }
        .table-meta { font-size: 0.8rem; color: var(--text-muted); display: flex; gap: 16px; }
        .table-content { padding: 20px; display: none; }
        .table-content.open { display: block; }
        .column-grid { display: grid; gap: 8px; }
        .column-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; background: var(--bg-main); border-radius: 8px; }
        .column-name { font-weight: 500; }
        .badge { padding: 2px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 600; }
        .badge-pk { background: #fef3c7; color: #92400e; }
        .column-type { font-size: 0.8rem; color: var(--text-muted); font-family: 'SF Mono', Monaco, monospace; }
        .fk-link { margin-top: 12px; padding: 12px; background: #eff6ff; border-radius: 8px; font-size: 0.85rem; color: #1e40af; }

        /* Chat */
        .chat-container { display: flex; flex-direction: column; height: calc(100vh - 180px); }
        .chat-messages { flex: 1; overflow-y: auto; padding: 20px; background: var(--bg-main); border-radius: 16px; margin-bottom: 20px; }
        .message { margin-bottom: 20px; display: flex; gap: 12px; }
        .message.user { flex-direction: row-reverse; }
        .message-avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; overflow: hidden; }
        .message-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .message.user .message-avatar { background: var(--primary); color: white; }
        .message.assistant .message-avatar { background: #e2e8f0; color: #475569; }
        .message-content { max-width: 88%; padding: 14px 18px; border-radius: 16px; font-size: 0.9rem; line-height: 1.6; }
        .message.user .message-content { background: var(--primary); color: white; border-bottom-right-radius: 4px; }
        .message.assistant .message-content { background: white; color: #1e293b; border: 1px solid var(--border-color); border-bottom-left-radius: 4px; }

        .chat-sql { background: #f8fafc; color: #64748b; padding: 10px 14px; border-radius: 8px; font-family: 'SF Mono', Monaco, monospace; font-size: 0.75rem; margin: 8px 0; overflow-x: auto; white-space: pre-wrap; border: 1px solid var(--border-color); opacity: 0.7; transition: opacity 0.2s; }
        .chat-sql:hover { opacity: 1; color: #475569; }

        /* Validation feedback */
        .validation-feedback { font-size: 0.75rem; padding: 10px 14px; border-radius: 8px; margin: 8px 0; display: flex; align-items: flex-start; gap: 8px; }
        .validation-feedback.good { background: #f0fdf4; color: #166534; border-left: 3px solid var(--success); }
        .validation-feedback.warning { background: #fffbeb; color: #92400e; border-left: 3px solid var(--warning); }
        .validation-feedback.error { background: #fef2f2; color: #991b1b; border-left: 3px solid var(--error); }
        .validation-icon { flex-shrink: 0; }
        .validation-content { flex: 1; }
        .validation-message { font-weight: 500; }
        .validation-issues { margin-top: 4px; opacity: 0.9; }
        .validation-issues li { margin-left: 12px; list-style: disc; }
        .validation-suggestions { margin-top: 4px; font-style: italic; opacity: 0.8; }
        .chat-table-wrapper { overflow-x: auto; margin: 12px 0; border-radius: 10px; border: 1px solid var(--border-color); max-height: 350px; }
        .chat-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        .chat-table th, .chat-table td { padding: 10px 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
        .chat-table th { background: #f8fafc; font-weight: 600; position: sticky; top: 0; }
        .chat-table tr:hover { background: #f8fafc; }
        .chat-table td { max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        .chat-chart { margin: 16px 0; background: white; border-radius: 10px; padding: 16px; border: 1px solid var(--border-color); }
        .chart-container { position: relative; height: 280px; }

        .result-footer { display: flex; align-items: center; gap: 12px; margin-top: 12px; flex-wrap: wrap; }
        .result-summary { font-size: 0.82rem; color: var(--text-muted); }

        /* Natural Answer */
        .natural-answer { background: linear-gradient(135deg, #f0fdf4, #ecfdf5); border-left: 3px solid var(--success); padding: 14px 18px; border-radius: 10px; margin-bottom: 12px; font-size: 0.95rem; color: #166534; }
        .natural-answer strong { color: #15803d; font-weight: 600; }

        /* Rating & Confidence */
        .rating-group { display: flex; align-items: center; gap: 4px; }
        .rating-btn { background: none; border: none; padding: 4px 6px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; opacity: 0.4; transition: all 0.2s; }
        .rating-btn:hover { opacity: 0.8; background: var(--bg-main); }
        .rating-btn.selected { opacity: 1; }
        .rating-btn.selected.correct { color: var(--success); }
        .rating-btn.selected.wrong { color: var(--error); }

        .confidence-pill { padding: 4px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; }
        .confidence-high { background: #dcfce7; color: #166534; }
        .confidence-medium { background: #fef3c7; color: #92400e; }
        .confidence-low { background: #fee2e2; color: #991b1b; }

        .feedback-input { margin-top: 8px; display: none; }
        .feedback-input.show { display: flex; gap: 8px; }
        .feedback-input input { flex: 1; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 0.8rem; }

        /* Pin */
        .pin-btn { background: none; border: 1px solid var(--border-color); padding: 4px 10px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 4px; opacity: 0.5; transition: all 0.2s; }
        .pin-btn:hover { background: var(--bg-main); border-color: var(--primary); color: var(--primary); opacity: 1; }

        .chat-input-area { display: flex; gap: 12px; }
        .chat-input-area .form-input { flex: 1; }

        .spinner { width: 18px; height: 18px; border: 2px solid rgba(99,102,241,0.2); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; display: inline-block; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-overlay { display: flex; align-items: center; justify-content: center; gap: 12px; padding: 40px; color: var(--text-muted); }

        /* Coming Soon Panel */
        .coming-soon-panel { text-align: center; padding: 80px 40px; }
        .coming-soon-icon { font-size: 72px; margin-bottom: 24px; }
        .coming-soon-title { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 2rem; font-weight: 700; margin-bottom: 12px; color: #1e293b; }
        .coming-soon-desc { color: var(--text-muted); font-size: 1rem; max-width: 400px; margin: 0 auto 32px; }
        .coming-soon-badge { display: inline-block; background: var(--gradient-2); color: white; padding: 8px 24px; border-radius: 20px; font-weight: 600; font-size: 0.85rem; }

        /* Dashboard */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .dashboard-item { background: white; border-radius: 16px; border: 1px solid var(--border-color); overflow: hidden; }
        .dashboard-item-header { padding: 12px 16px; background: #fafafa; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .dashboard-item-title { font-weight: 600; font-size: 0.9rem; }
        .dashboard-item-content { padding: 16px; }
        .dashboard-item .chat-table-wrapper { max-height: 250px; margin: 0; }
        .dashboard-item .chart-container { height: 220px; }

        /* Numeric Widget */
        .dashboard-widget { background: white; border-radius: 16px; border: 1px solid var(--border-color); padding: 24px; position: relative; }
        .dashboard-widget-value { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 2.5rem; font-weight: 700; background: var(--gradient-1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; line-height: 1; }
        .dashboard-widget-label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }
        .dashboard-widget-remove { position: absolute; top: 8px; right: 8px; background: none; border: none; opacity: 0.3; cursor: pointer; font-size: 0.8rem; padding: 4px; border-radius: 4px; }
        .dashboard-widget:hover .dashboard-widget-remove { opacity: 0.7; }
        .dashboard-widget-remove:hover { opacity: 1 !important; background: var(--bg-main); }

        /* Nav badge for pinned count */
        .nav-count { margin-left: auto; background: var(--primary); color: white; font-size: 0.65rem; padding: 2px 6px; border-radius: 10px; min-width: 18px; text-align: center; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal-overlay.show { display: flex; }
        .modal { background: white; border-radius: 16px; padding: 28px; width: 400px; max-width: 90%; }
        .modal-title { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1.1rem; font-weight: 600; margin-bottom: 16px; }
        .modal-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px; }

        .doc-section { margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid var(--border-color); }
        .doc-table-name { font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
        .doc-table-name .icon { width: 32px; height: 32px; background: var(--primary); color: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .doc-column-list { display: grid; gap: 12px; margin-top: 16px; }
        .doc-column-item { display: grid; grid-template-columns: 150px 1fr; gap: 12px; align-items: center; }
        .doc-column-name { font-weight: 500; font-size: 0.9rem; }
        .doc-column-name span { display: block; font-size: 0.75rem; color: var(--text-muted); font-weight: 400; }

        /* Landing Page Styles */
        .landing-page {
            width: 100%; min-height: 100vh; display: flex; flex-direction: column;
            position: relative; z-index: 1;
        }
        .landing-header {
            padding: 24px 48px; display: flex; align-items: center; justify-content: space-between;
        }
        .landing-logo { display: flex; align-items: center; gap: 12px; }
        .landing-logo-icon {
            width: 48px; height: 48px; background: var(--gradient-2); border-radius: 12px;
            display: flex; align-items: center; justify-content: center; font-size: 24px;
            box-shadow: 0 4px 16px rgba(249, 115, 22, 0.3);
        }
        .landing-logo-text {
            font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1.75rem; font-weight: 800;
            color: white;
        }

        .hero-section { flex: 1; padding: 40px 48px 60px; }
        .hero-content { display: flex; gap: 60px; align-items: center; max-width: 1200px; margin: 0 auto; }
        .hero-left { flex: 1; }
        .hero-title {
            font-family: 'Plus Jakarta Sans', sans-serif; font-size: 2.8rem; font-weight: 800;
            line-height: 1.2; margin-bottom: 24px; color: white;
        }
        .hero-subtitle {
            font-size: 1.2rem; color: #94a3b8; line-height: 1.6; max-width: 500px;
        }

        .hero-right { flex: 0 0 420px; }
        .waitlist-card {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px;
            padding: 40px; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }
        .waitlist-header { text-align: center; margin-bottom: 32px; }
        .waitlist-icon {
            width: 64px; height: 64px; margin: 0 auto 16px; background: var(--gradient-2);
            border-radius: 16px; display: flex; align-items: center; justify-content: center;
            font-size: 32px; box-shadow: 0 8px 24px rgba(249, 115, 22, 0.3);
        }
        .waitlist-title {
            font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1.5rem; font-weight: 700;
            color: white; margin-bottom: 8px;
        }
        .waitlist-subtitle { color: #94a3b8; font-size: 0.95rem; }
        .waitlist-form { display: flex; flex-direction: column; gap: 16px; }
        .waitlist-input {
            width: 100%; padding: 16px 20px; background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 12px;
            font-size: 1rem; color: white; font-family: inherit; transition: all 0.3s;
        }
        .waitlist-input::placeholder { color: #64748b; }
        .waitlist-input:focus { outline: none; border-color: var(--accent); background: rgba(255, 255, 255, 0.1); }
        .waitlist-btn {
            width: 100%; padding: 16px 24px; background: var(--gradient-2); border: none;
            border-radius: 12px; font-size: 1rem; font-weight: 700; color: white;
            font-family: 'Plus Jakarta Sans', sans-serif; cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .waitlist-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(249, 115, 22, 0.4); }
        .waitlist-btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
        .waitlist-message { text-align: center; margin-top: 16px; font-size: 0.9rem; min-height: 24px; }
        .waitlist-message.success { color: var(--success); }
        .waitlist-message.error { color: var(--error); }
        .waitlist-note { text-align: center; color: #64748b; font-size: 0.8rem; margin-top: 20px; }

        .features-section { padding: 80px 48px; background: rgba(0, 0, 0, 0.2); }
        .features-title {
            font-family: 'Plus Jakarta Sans', sans-serif; font-size: 2rem; font-weight: 700;
            color: white; text-align: center; margin-bottom: 48px;
        }
        .features-grid { display: flex; flex-direction: column; gap: 48px; max-width: 1000px; margin: 0 auto; }
        .feature-card {
            background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px; overflow: hidden; transition: all 0.3s;
            display: flex; flex-direction: row; min-height: 300px;
        }
        .feature-card:nth-child(even) { flex-direction: row-reverse; }
        .feature-card:hover { border-color: rgba(255, 255, 255, 0.15); }
        .feature-screenshot { flex: 1; padding: 32px; display: flex; align-items: center; justify-content: center; }
        .screenshot-placeholder {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(249, 115, 22, 0.2));
            border-radius: 12px; width: 100%; height: 100%; min-height: 240px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; gap: 12px;
            border: 1px dashed rgba(255, 255, 255, 0.2);
        }
        .screenshot-placeholder img {
            width: 100%; height: 100%; object-fit: contain; border-radius: 12px;
        }
        .screenshot-icon { font-size: 64px; }
        .screenshot-label { color: #94a3b8; font-size: 0.9rem; font-weight: 500; }
        .feature-content { flex: 1; padding: 40px; display: flex; flex-direction: column; justify-content: center; }
        .feature-name {
            font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1.5rem; font-weight: 700;
            color: white; margin-bottom: 16px;
        }
        .feature-desc { color: #94a3b8; font-size: 1rem; line-height: 1.7; }

        .landing-footer { padding: 32px 48px; text-align: center; color: #64748b; font-size: 0.85rem; }

        @media (max-width: 1024px) {
            .hero-content { flex-direction: column; text-align: center; }
            .hero-left { text-align: center; }
            .hero-subtitle { margin: 0 auto; }
            .hero-right { flex: none; width: 100%; max-width: 420px; }
            .feature-card, .feature-card:nth-child(even) { flex-direction: column; }
            .feature-screenshot { min-height: 200px; }
        }
        @media (max-width: 600px) {
            .landing-header { padding: 20px 24px; }
            .hero-section { padding: 24px; }
            .hero-title { font-size: 2.2rem; }
            .features-section { padding: 48px 24px; }
            .features-title { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <!-- Landing/Waitlist Screen -->
    <div class="login-screen" id="login-screen">
        <div class="login-bg-shapes"></div>
        <div class="landing-page">
            <!-- Header -->
            <header class="landing-header">
                <div class="landing-logo">
                    <span class="landing-logo-icon">üéØ</span>
                    <span class="landing-logo-text">DecisionOS</span>
                </div>
            </header>

            <!-- Hero Section -->
            <section class="hero-section">
                <div class="hero-content">
                    <div class="hero-left">
                        <h1 class="hero-title">Sometimes you just need to be nudged to stay on track.</h1>
                        <p class="hero-subtitle">Ensure your strategy, your execution and your metrics are all pointing in the same direction.</p>
                    </div>
                    <div class="hero-right">
                        <div class="waitlist-card">
                            <div class="waitlist-header">
                                <div class="waitlist-icon">üöÄ</div>
                                <h2 class="waitlist-title">Join the Waitlist</h2>
                                <p class="waitlist-subtitle">Be the first to know when we launch</p>
                            </div>
                            <form class="waitlist-form" onsubmit="submitWaitlist(event)">
                                <input type="email" class="waitlist-input" id="waitlist-email" placeholder="Enter your email address" required>
                                <button type="submit" class="waitlist-btn" id="waitlist-btn">
                                    <span id="waitlist-btn-text">Add to Waitlist</span>
                                    <span id="waitlist-spinner" class="spinner" style="display:none"></span>
                                </button>
                            </form>
                            <div id="waitlist-message" class="waitlist-message"></div>
                                                    </div>
                    </div>
                </div>
            </section>

            <!-- Features Section -->
            <section class="features-section">
                <h2 class="features-title">Everything you need to align strategy with execution</h2>
                <div class="features-grid">
                    <!-- Feature 1: Clarify Your Strategy -->
                    <div class="feature-card">
                        <div class="feature-screenshot">
                            <div class="screenshot-placeholder">
                                <img src="images/strategy-linkup.jpg" alt="Strategy Dashboard">
                            </div>
                        </div>
                        <div class="feature-content">
                            <h3 class="feature-name">Clarify Your Strategy</h3>
                            <p class="feature-desc">Upload your strategy and brainstorm around it. See what percentage of your implementation plan is linked to the strategy.</p>
                        </div>
                    </div>

                    <!-- Feature 2: Simulate Your Personas -->
                    <div class="feature-card">
                        <div class="feature-screenshot">
                            <div class="screenshot-placeholder">
                                <img src="images/personas.jpg" alt="Persona Simulator">
                            </div>
                        </div>
                        <div class="feature-content">
                            <h3 class="feature-name">Simulate Your Personas</h3>
                            <p class="feature-desc">Create your personas and let them talk to your requirements. Bulletproof your requirements by simulating how your personas are likely to interact with your new features.</p>
                        </div>
                    </div>

                    <!-- Feature 3: Triangulate Customer Feedback -->
                    <div class="feature-card">
                        <div class="feature-screenshot">
                            <div class="screenshot-placeholder">
                                <img src="images/customer-feedback.png" alt="Feedback Triangulation">
                            </div>
                        </div>
                        <div class="feature-content">
                            <h3 class="feature-name">Triangulate Customer Feedback</h3>
                            <p class="feature-desc">Upload feedback from Play Store, App Store, and your customer service representatives. See how much of the feedback you're addressing in your plans and ensure nothing falls through the cracks.</p>
                        </div>
                    </div>

                    <!-- Feature 4: Align Your Goals to Strategy -->
                    <div class="feature-card">
                        <div class="feature-screenshot">
                            <div class="screenshot-placeholder">
                                <span class="screenshot-icon">üìä</span>
                                <span class="screenshot-label">Goals Alignment</span>
                            </div>
                        </div>
                        <div class="feature-content">
                            <h3 class="feature-name">Align Your Goals to Strategy</h3>
                            <p class="feature-desc">Compare your long-term and your short-term goals and see what percentage of your execution is linked to your strategy.</p>
                        </div>
                    </div>

                    <!-- Feature 5: View Goals and Metrics -->
                    <div class="feature-card">
                        <div class="feature-screenshot">
                            <div class="screenshot-placeholder">
                                <span class="screenshot-icon">üìà</span>
                                <span class="screenshot-label">Metrics Dashboard</span>
                            </div>
                        </div>
                        <div class="feature-content">
                            <h3 class="feature-name">View Goals and Metrics</h3>
                            <p class="feature-desc">Connect to your primary data source and track your metrics in real-time with AI-generated visualization tools.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <footer class="landing-footer">
                <p>&copy; 2024 DecisionOS. Built for Product Managers.</p>
            </footer>
        </div>
    </div>

    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <div class="logo-icon">üìä</div>
                <div><div class="logo-text">DecisionOS</div><div class="logo-subtitle">Product Intelligence</div></div>
            </div>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Intelligence</div>
                <a class="nav-item coming-soon" data-panel="competitive" id="nav-competitive" onclick="switchPanel('competitive')">
                    <span class="nav-icon">üéØ</span>Competitive Intelligence<span class="nav-badge soon">Soon</span>
                </a>
                <a class="nav-item coming-soon" data-panel="strategy" id="nav-strategy" onclick="switchPanel('strategy')">
                    <span class="nav-icon">üß≠</span>Strategy Validator<span class="nav-badge soon">Soon</span>
                </a>
                <a class="nav-item coming-soon" data-panel="feature" id="nav-feature" onclick="switchPanel('feature')">
                    <span class="nav-icon">‚úì</span>Feature Validator<span class="nav-badge soon">Soon</span>
                </a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Data & Analytics</div>
                <a class="nav-item disabled" data-panel="query" id="nav-query">
                    <span class="nav-icon">üí¨</span>Ask Questions<span class="nav-badge" style="display:none" id="query-badge">Ready</span>
                </a>
                <a class="nav-item disabled" data-panel="explore" id="nav-explore">
                    <span class="nav-icon">üîç</span>Schema Explorer
                </a>
                <a class="nav-item disabled" data-panel="document" id="nav-document">
                    <span class="nav-icon">üìù</span>Documentation
                </a>
            </div>
            <div class="nav-section" id="dashboards-section">
                <div class="nav-section-title">Dashboards</div>
                <a class="nav-item disabled" data-panel="dashboard-main" id="nav-dashboard-main" onclick="switchPanel('dashboard-main')">
                    <span class="nav-icon">üìå</span>Main Dashboard
                </a>
            </div>
            <div class="nav-section" style="margin-top: auto;">
                <div class="nav-section-title">Settings</div>
                <a class="nav-item" data-panel="connect" id="nav-connect" onclick="switchPanel('connect')">
                    <span class="nav-icon">‚öôÔ∏è</span>Connection
                </a>
            </div>
        </nav>
        <div class="connection-status">
            <div class="status-indicator"><div class="status-dot" id="status-dot"></div><span id="status-text">Not connected</span></div>
        </div>
    </aside>

    <main class="main-content">
        <div class="top-bar">
            <div><h1 class="page-title" id="page-title">Welcome</h1><p class="page-subtitle" id="page-subtitle">Initializing...</p></div>
            <div class="user-menu" id="user-menu" style="display:none">
                <div class="user-dropdown">
                    <button class="user-dropdown-btn" onclick="toggleUserDropdown()">
                        <img class="user-avatar" id="user-avatar" src="" alt="">
                        <span class="user-name" id="user-name"></span>
                        <span>‚ñº</span>
                    </button>
                    <div class="user-dropdown-menu" id="user-dropdown-menu">
                        <div class="user-dropdown-item" onclick="window.location.reload()">Refresh</div>
                        <div class="user-dropdown-item danger" onclick="logout()">Sign Out</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-area">
            <div class="panel active" id="panel-welcome">
                <div style="text-align:center;padding:80px 40px;">
                    <div style="font-size:64px;margin-bottom:24px">üìä</div>
                    <h2 style="font-family:'Plus Jakarta Sans',sans-serif;font-size:1.8rem;font-weight:700;margin-bottom:12px">Welcome to Data Reporter</h2>
                    <p style="color:var(--text-muted);font-size:1rem;margin-bottom:32px">Connecting to database...</p>
                    <div class="spinner" style="margin:0 auto"></div>
                </div>
            </div>

            <!-- Coming Soon Panels -->
            <div class="panel" id="panel-competitive">
                <div class="coming-soon-panel">
                    <div class="coming-soon-icon">üéØ</div>
                    <h2 class="coming-soon-title">Competitive Intelligence</h2>
                    <p class="coming-soon-desc">Track competitors, analyze market trends, and get real-time alerts on industry movements.</p>
                    <span class="coming-soon-badge">Coming Soon</span>
                </div>
            </div>

            <div class="panel" id="panel-strategy">
                <div class="coming-soon-panel">
                    <div class="coming-soon-icon">üß≠</div>
                    <h2 class="coming-soon-title">Strategy Validator</h2>
                    <p class="coming-soon-desc">Validate your business strategies against market data, competitor analysis, and industry benchmarks.</p>
                    <span class="coming-soon-badge">Coming Soon</span>
                </div>
            </div>

            <div class="panel" id="panel-feature">
                <div class="coming-soon-panel">
                    <div class="coming-soon-icon">‚úì</div>
                    <h2 class="coming-soon-title">Feature Validator</h2>
                    <p class="coming-soon-desc">Test and validate new product features with AI-powered analysis and user feedback insights.</p>
                    <span class="coming-soon-badge">Coming Soon</span>
                </div>
            </div>

            <div class="panel" id="panel-connect">
                <div class="card">
                    <div class="card-header"><h2 class="card-title">Database Connection</h2></div>
                    <div id="connect-status"></div>
                    <div class="form-group">
                        <label class="form-label">Connection String</label>
                        <input type="text" class="form-input code" id="connection-string" placeholder="postgresql://user:pass@host:5432/db">
                    </div>
                    <button class="btn btn-primary" onclick="connectDatabase()">üîó Connect</button>
                </div>
                <div class="card">
                    <div class="card-header"><h2 class="card-title">Quick Connect Examples</h2></div>
                    <div class="examples-grid">
                        <div class="example-item" onclick="useExample('sqlite:///ecommerce.db')">
                            <div class="example-label">SQLite (Local)</div>sqlite:///ecommerce.db
                        </div>
                        <div class="example-item" onclick="useExample('postgresql://user:pass@localhost:5432/mydb')">
                            <div class="example-label">PostgreSQL</div>postgresql://user:pass@localhost:5432/mydb
                        </div>
                        <div class="example-item" onclick="useExample('mysql://user:pass@localhost:3306/mydb')">
                            <div class="example-label">MySQL</div>mysql://user:pass@localhost:3306/mydb
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel" id="panel-explore">
                <div id="explore-status"></div>
                <div class="stats-grid" id="schema-stats" style="display:none">
                    <div class="stat-card"><div class="stat-value" id="stat-tables">0</div><div class="stat-label">Tables</div></div>
                    <div class="stat-card"><div class="stat-value" id="stat-columns">0</div><div class="stat-label">Columns</div></div>
                    <div class="stat-card"><div class="stat-value" id="stat-rows">0</div><div class="stat-label">Rows</div></div>
                </div>
                <div class="card">
                    <div class="card-header"><h2 class="card-title">Database Schema</h2><button class="btn btn-secondary btn-sm" onclick="loadSchema()">üîÑ Refresh</button></div>
                    <div id="schema-explorer"><div class="loading-overlay"><div class="spinner"></div> Loading...</div></div>
                </div>
            </div>

            <div class="panel" id="panel-document">
                <div id="doc-status"></div>
                <div class="card">
                    <div class="card-header"><div><h2 class="card-title">Schema Documentation</h2></div><button class="btn btn-primary btn-sm" onclick="saveDocumentation()">üíæ Save</button></div>
                    <div id="documentation-form"></div>
                </div>
            </div>

            <div class="panel" id="panel-query">
                <div class="chat-container">
                    <div class="chat-messages" id="chat-messages">
                        <div class="message assistant">
                            <div class="message-avatar">ü§ñ</div>
                            <div class="message-content">
                                <strong>Hello! I'm your data assistant.</strong><br><br>
                                Ask me anything about your data! Examples:<br>
                                ‚Ä¢ "Show all customers"<br>
                                ‚Ä¢ "How many orders by status?"<br>
                                ‚Ä¢ "Top 10 products by revenue"<br>
                                ‚Ä¢ "Average order value this month"
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" class="form-input" id="question" placeholder="Ask a question about your data..." onkeypress="if(event.key==='Enter')askQuestion()">
                        <button class="btn btn-primary" onclick="askQuestion()">Send ‚Üí</button>
                    </div>
                </div>
            </div>

            <div class="panel" id="panel-dashboard-main">
                <div class="dashboard-grid" id="dashboard-main-grid"></div>
                <div id="empty-dashboard" style="text-align:center;padding:60px;color:var(--text-muted)">
                    <div style="font-size:48px;margin-bottom:16px">üìå</div>
                    <div style="font-family:'Plus Jakarta Sans',sans-serif;font-size:1.1rem;font-weight:600;color:#374151">No pinned items yet</div>
                    <div>Ask questions and pin your favorite results here</div>
                </div>
            </div>
        </div>
    </main>

    <!-- Pin Modal -->
    <div class="modal-overlay" id="pin-modal">
        <div class="modal">
            <div class="modal-title">üìå Pin to Dashboard</div>
            <div class="form-group">
                <label class="form-label">Dashboard Name</label>
                <input type="text" class="form-input" id="pin-dashboard-name" value="Main Dashboard" placeholder="Main Dashboard">
            </div>
            <div class="form-group">
                <label class="form-label">Title (optional)</label>
                <input type="text" class="form-input" id="pin-title" placeholder="Auto-generated from question">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closePinModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmPin()">Pin</button>
            </div>
        </div>
    </div>

    <script>
        // Use relative URLs so it works on any domain (localhost or Cloud Run)
        const API_BASE = '/api';
        const AUTH_BASE = '/auth';
        let schemaData = null;
        let documentation = {};
        let chartCounter = 0;
        let dashboards = { 'Main Dashboard': [] };
        let currentPinData = null;
        let currentUser = null;

        // Auth functions
        async function checkAuth() {
            try {
                const r = await fetch(`${AUTH_BASE}/user`, { credentials: 'include' });
                const d = await r.json();
                if (d.user) {
                    currentUser = d.user;
                    showMainApp();
                } else {
                    showLoginScreen();
                }
            } catch (e) {
                console.error('Auth check failed:', e);
                showLoginScreen();
            }
        }

        function loginWithGoogle() {
            window.location.href = `${AUTH_BASE}/google`;
        }

        async function logout() {
            try {
                await fetch(`${AUTH_BASE}/logout`, { credentials: 'include' });
            } catch (e) {
                console.error('Logout error:', e);
            }
            currentUser = null;
            showLoginScreen();
        }

        function showLoginScreen() {
            document.getElementById('login-screen').classList.remove('hidden');
            document.querySelector('.sidebar').style.display = 'none';
            document.querySelector('.main-content').style.display = 'none';
        }

        function showMainApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.querySelector('.sidebar').style.display = 'flex';
            document.querySelector('.main-content').style.display = 'block';

            const userMenu = document.getElementById('user-menu');
            userMenu.style.display = 'flex';
            document.getElementById('user-name').textContent = currentUser.name;
            document.getElementById('user-avatar').src = currentUser.picture || '';

            autoConnect();
        }

        function toggleUserDropdown() {
            document.getElementById('user-dropdown-menu').classList.toggle('show');
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.user-dropdown')) {
                document.getElementById('user-dropdown-menu')?.classList.remove('show');
            }
        });

        function switchPanel(panelName) {
            const navItem = document.querySelector(`[data-panel="${panelName}"]`);
            if (navItem && navItem.classList.contains('disabled') && !navItem.classList.contains('coming-soon')) return;

            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            const panel = document.getElementById(`panel-${panelName}`);
            if (panel) { panel.classList.add('active'); if (navItem) navItem.classList.add('active'); }

            const titles = {
                welcome: ['Welcome', 'Initializing...'],
                connect: ['Settings', 'Database connection'],
                explore: ['Schema Explorer', 'Browse your database tables'],
                document: ['Documentation', 'Document your schema'],
                query: ['Ask Questions', 'Query with natural language'],
                competitive: ['Competitive Intelligence', 'Track competitors & market trends'],
                strategy: ['Strategy Validator', 'Validate business strategies'],
                feature: ['Feature Validator', 'Test and validate features']
            };
            if (titles[panelName]) {
                document.getElementById('page-title').textContent = titles[panelName][0];
                document.getElementById('page-subtitle').textContent = titles[panelName][1];
            } else if (panelName.startsWith('dashboard-')) {
                const name = panelName.replace('dashboard-', '').replace(/-/g, ' ');
                const displayName = name === 'main' ? 'Main Dashboard' : name.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
                document.getElementById('page-title').textContent = displayName;
                document.getElementById('page-subtitle').textContent = 'Your pinned queries and charts';
                renderDashboard(displayName);
            }

            if (panelName === 'explore' && !schemaData) loadSchema();
            if (panelName === 'document') renderDocumentationForm();
        }

        function enableNav(panelName) {
            const nav = document.getElementById(`nav-${panelName}`);
            if (nav) { nav.classList.remove('disabled'); nav.onclick = () => switchPanel(panelName); }
        }

        function updateConnectionStatus(connected, msg) {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            if (connected) { dot.classList.add('connected'); text.textContent = msg || 'Connected'; }
            else { dot.classList.remove('connected'); text.textContent = msg || 'Not connected'; }
        }

        function showStatus(id, type, msg) { document.getElementById(id).innerHTML = `<div class="alert alert-${type}">${msg}</div>`; }
        function useExample(s) { document.getElementById('connection-string').value = s; }

        async function connectDatabase() {
            const cs = document.getElementById('connection-string').value.trim();
            if (!cs) { showStatus('connect-status', 'error', '‚ö†Ô∏è Enter connection string'); return; }
            showStatus('connect-status', 'info', '<div class="spinner"></div> Connecting...');
            try {
                const r = await fetch(`${API_BASE}/connect`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({connectionString: cs}),
                    credentials: 'include'
                });
                const d = await r.json();
                if (d.success) {
                    showStatus('connect-status', 'success', '‚úì Connected successfully!');
                    updateConnectionStatus(true, d.dbType);
                    enableNav('explore'); enableNav('document'); enableNav('query');
                    document.getElementById('nav-dashboard-main').classList.remove('disabled');
                    document.getElementById('query-badge').style.display = 'inline';
                    setTimeout(() => switchPanel('query'), 500);
                } else { showStatus('connect-status', 'error', `‚úó ${d.error}`); }
            } catch (e) { showStatus('connect-status', 'error', `‚úó ${e.message}`); }
        }

        async function loadSchema() {
            const el = document.getElementById('schema-explorer');
            el.innerHTML = '<div class="loading-overlay"><div class="spinner"></div> Loading schema...</div>';
            try {
                const r = await fetch(`${API_BASE}/explore`, { credentials: 'include' });
                const d = await r.json();
                if (d.tables) {
                    schemaData = d.tables;
                    renderSchema(schemaData);
                    document.getElementById('schema-stats').style.display = 'grid';
                    document.getElementById('stat-tables').textContent = Object.keys(schemaData).length;
                    let cols=0, rows=0;
                    Object.values(schemaData).forEach(t => { cols += t.columns.length; rows += t.rowCount||0; });
                    document.getElementById('stat-columns').textContent = cols;
                    document.getElementById('stat-rows').textContent = rows.toLocaleString();
                } else {
                    showStatus('explore-status', 'error', `Error: ${d.error}`);
                }
            } catch (e) { showStatus('explore-status', 'error', `Error: ${e.message}`); }
        }

        function renderSchema(schema) {
            let html = '<div class="table-list">';
            for (const [name, info] of Object.entries(schema)) {
                html += `<div class="table-card"><div class="table-header" onclick="document.getElementById('table-${name}').classList.toggle('open')"><span class="table-name">üìã ${name}</span><div class="table-meta"><span>${info.columns.length} columns</span><span>${(info.rowCount||0).toLocaleString()} rows</span></div></div><div class="table-content" id="table-${name}"><div class="column-grid">${info.columns.map(c => `<div class="column-row"><div><span class="column-name">${c.name}</span>${c.primaryKey ? ' <span class="badge badge-pk">PK</span>' : ''}</div><span class="column-type">${c.type}</span></div>`).join('')}</div>${info.foreignKeys && info.foreignKeys.length ? `<div class="fk-link"><strong>üîó</strong> ${info.foreignKeys.map(f => `${f.column} ‚Üí ${f.references.table}`).join(', ')}</div>` : ''}</div></div>`;
            }
            document.getElementById('schema-explorer').innerHTML = html + '</div>';
        }

        function renderDocumentationForm() {
            if (!schemaData) return;
            let html = '';
            for (const [name, info] of Object.entries(schemaData)) {
                const doc = documentation[name] || {};
                html += `<div class="doc-section"><div class="doc-table-name"><span class="icon">üìã</span>${name}</div><div class="form-group"><label class="form-label">Table Description</label><input type="text" class="form-input" value="${doc.description||''}" onchange="updateDoc('${name}',null,this.value)" placeholder="What does this table store?"></div><div class="doc-column-list">${info.columns.map(c => `<div class="doc-column-item"><div class="doc-column-name">${c.name}<span>${c.type}</span></div><input type="text" class="form-input" value="${(doc.columns||{})[c.name]||''}" onchange="updateDoc('${name}','${c.name}',this.value)" placeholder="Description..."></div>`).join('')}</div></div>`;
            }
            document.getElementById('documentation-form').innerHTML = html;
        }

        function updateDoc(table, col, val) {
            if (!documentation[table]) documentation[table] = {description:'', columns:{}};
            if (col) documentation[table].columns[col] = val;
            else documentation[table].description = val;
        }

        async function saveDocumentation() {
            showStatus('doc-status', 'info', 'Saving...');
            try {
                const r = await fetch(`${API_BASE}/documentation`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({documentation}),
                    credentials: 'include'
                });
                const d = await r.json();
                showStatus('doc-status', d.success ? 'success' : 'error', d.success ? '‚úì Documentation saved!' : d.error);
            } catch (e) { showStatus('doc-status', 'error', e.message); }
        }

        async function askQuestion() {
            const q = document.getElementById('question').value.trim();
            if (!q) return;
            addMessage('user', q);
            document.getElementById('question').value = '';

            const loadingId = 'l-' + Date.now();
            addMessage('assistant', `<div id="${loadingId}"><div class="spinner"></div> Analyzing your question...</div>`, true);

            try {
                const gr = await fetch(`${API_BASE}/generate-query`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({question: q}),
                    credentials: 'include'
                });
                const gd = await gr.json();
                if (gd.error) { replaceMessage(loadingId, `Error: ${gd.error}`); return; }

                const query = gd.query;
                const validation = gd.validation || null;
                const er = await fetch(`${API_BASE}/query`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({query}),
                    credentials: 'include'
                });
                const ed = await er.json();

                if (ed.columns) {
                    const confidence = validation ? validation.confidence : calculateConfidence(q, query, ed.data);
                    const html = buildResultHtml(q, query, ed.columns, ed.data, confidence, validation);
                    replaceMessage(loadingId, html);
                } else {
                    replaceMessage(loadingId, `Query error: ${ed.error}<div class="chat-sql">${query}</div>`);
                }
            } catch (e) { replaceMessage(loadingId, `Error: ${e.message}`); }
        }

        function calculateConfidence(question, query, data) {
            let score = 70;
            const q = question.toLowerCase();
            if (q.includes('show') || q.includes('list') || q.includes('all')) score += 10;
            if (q.includes('count') || q.includes('how many')) score += 15;
            if (data.length > 0 && data.length < 1000) score += 10;
            if (query.toLowerCase().includes('where')) score += 5;
            return Math.min(score, 95);
        }

        function addMessage(type, content, isHtml = false) {
            const c = document.getElementById('chat-messages');
            const avatar = type === 'user' ? (currentUser?.picture ? `<img src="${currentUser.picture}">` : 'üë§') : 'ü§ñ';
            c.insertAdjacentHTML('beforeend', `<div class="message ${type}"><div class="message-avatar">${avatar}</div><div class="message-content">${isHtml ? content : escapeHtml(content)}</div></div>`);
            c.scrollTop = c.scrollHeight;
        }

        function replaceMessage(id, content) {
            const el = document.getElementById(id);
            if (el) el.parentElement.innerHTML = content;
            document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;
        }

        function escapeHtml(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }

        function generateNaturalAnswer(question, columns, data) {
            if (data.length === 0) return null;
            const q = question.toLowerCase();
            const firstRow = data[0];
            const firstValue = firstRow[columns[0]];

            if (data.length === 1 && columns.length === 1) {
                if (q.includes('how many') || q.includes('count')) {
                    return `The count is <strong>${firstValue}</strong>`;
                } else if (q.includes('total') || q.includes('sum')) {
                    return `The total is <strong>${firstValue}</strong>`;
                } else if (q.includes('average') || q.includes('avg')) {
                    return `The average is <strong>${firstValue}</strong>`;
                }
                return `The result is <strong>${firstValue}</strong>`;
            }

            if (data.length === 1 && columns.length <= 5) {
                const parts = columns.map(col => `<strong>${col}</strong>: ${firstRow[col] || '-'}`);
                return parts.join(', ');
            }

            if (data.length <= 10 && columns.length === 2) {
                const valueCol = columns[1];
                const isNumeric = data.every(row => !isNaN(parseFloat(row[valueCol])));
                if (isNumeric && (q.includes('by') || q.includes('group') || q.includes('per'))) {
                    const items = data.map(row => `<strong>${row[columns[0]]}</strong>: ${row[valueCol]}`).join(' | ');
                    return items;
                }
            }

            return null;
        }

        function buildResultHtml(question, query, columns, data, confidence, validation) {
            const resultId = 'r-' + Date.now();
            let html = '';

            const naturalAnswer = generateNaturalAnswer(question, columns, data);
            if (naturalAnswer) {
                html += `<div class="natural-answer">${naturalAnswer}</div>`;
            }

            if (validation && validation.issues && validation.issues.length > 0) {
                const status = validation.confidence >= 80 ? 'good' : validation.confidence >= 60 ? 'warning' : 'error';
                const icon = status === 'warning' ? '‚ö†Ô∏è' : status === 'error' ? '‚ùå' : '‚úì';
                html += `<div class="validation-feedback ${status}">
                    <span class="validation-icon">${icon}</span>
                    <div class="validation-content">
                        <div class="validation-message">Confidence: ${validation.confidence}%</div>
                        <ul class="validation-issues">${validation.issues.map(i => `<li>${i}</li>`).join('')}</ul>
                        ${validation.suggestions && validation.suggestions.length > 0 ? `<div class="validation-suggestions">Tip: ${validation.suggestions[0]}</div>` : ''}
                    </div>
                </div>`;
            }

            html += `<div class="chat-sql">${escapeHtml(query)}</div>`;

            if (data.length > 0) {
                if (data.length > 1 || !naturalAnswer) {
                    html += `<div class="chat-table-wrapper"><table class="chat-table"><thead><tr>${columns.map(c => `<th>${escapeHtml(c)}</th>`).join('')}</tr></thead><tbody>`;
                    const max = Math.min(data.length, 50);
                    for (let i = 0; i < max; i++) {
                        html += `<tr>${columns.map(col => `<td title="${escapeHtml(String(data[i][col]||''))}">${escapeHtml(String(data[i][col]||'-'))}</td>`).join('')}</tr>`;
                    }
                    html += '</tbody></table></div>';
                }

                const chartData = analyzeForChart(question, columns, data);
                if (chartData) {
                    chartCounter++;
                    const chartId = `chart-${chartCounter}`;
                    html += `<div class="chat-chart"><div class="chart-container"><canvas id="${chartId}"></canvas></div></div>`;
                    setTimeout(() => renderChart(chartId, chartData), 100);
                }
            }

            const confClass = confidence >= 85 ? 'high' : confidence >= 70 ? 'medium' : 'low';
            const confText = confidence >= 85 ? 'High' : confidence >= 70 ? 'Medium' : 'Low';

            html += `<div class="result-footer">
                <span class="result-summary">${data.length} row${data.length!==1?'s':''}</span>
                <span class="confidence-pill confidence-${confClass}">${confText} (${confidence}%)</span>
                <div class="rating-group">
                    <button class="rating-btn" onclick="rateResult('${resultId}', true, this)" title="Correct">‚úì</button>
                    <button class="rating-btn" onclick="rateResult('${resultId}', false, this)" title="Wrong">‚úó</button>
                </div>
                <button class="pin-btn" onclick="openPinModal('${escapeHtml(question)}', \`${escapeHtml(query)}\`, ${JSON.stringify(columns)}, ${JSON.stringify(data.slice(0,20))})">üìå Pin</button>
            </div>
            <div class="feedback-input" id="feedback-${resultId}">
                <input type="text" placeholder="What was wrong? (optional)" id="feedback-text-${resultId}">
                <button class="btn btn-sm btn-secondary" onclick="submitFeedback('${resultId}')">Submit</button>
            </div>`;

            return html;
        }

        function rateResult(id, correct, btn) {
            const btns = btn.parentElement.querySelectorAll('.rating-btn');
            btns.forEach(b => b.classList.remove('selected', 'correct', 'wrong'));
            btn.classList.add('selected', correct ? 'correct' : 'wrong');
            if (!correct) document.getElementById(`feedback-${id}`).classList.add('show');
            else document.getElementById(`feedback-${id}`).classList.remove('show');
        }

        function submitFeedback(id) {
            const text = document.getElementById(`feedback-text-${id}`).value;
            console.log('Feedback:', text);
            document.getElementById(`feedback-${id}`).innerHTML = '<span style="color:var(--success);font-size:0.8rem">Thanks for the feedback!</span>';
        }

        function analyzeForChart(question, columns, data) {
            if (data.length < 2 || data.length > 15) return null;
            const q = question.toLowerCase();
            if (!q.includes('count') && !q.includes('sum') && !q.includes('by ') && !q.includes('how many') && !q.includes('total') && !q.includes('group')) return null;
            if (columns.length < 2) return null;

            const valueCol = columns[columns.length - 1];
            const values = data.map(r => parseFloat(r[valueCol])).filter(v => !isNaN(v));
            if (values.length !== data.length) return null;

            return {
                type: data.length <= 5 ? 'pie' : 'bar',
                labels: data.map(r => String(r[columns[0]] || 'Unknown').substring(0, 20)),
                values: values,
                label: valueCol
            };
        }

        function renderChart(id, chartData) {
            const ctx = document.getElementById(id);
            if (!ctx) return;
            const colors = ['#6366f1', '#22c55e', '#f59e0b', '#ef4444', '#3b82f6', '#8b5cf6', '#ec4899', '#14b8a6'];
            new Chart(ctx, {
                type: chartData.type,
                data: {
                    labels: chartData.labels,
                    datasets: [{ label: chartData.label, data: chartData.values, backgroundColor: chartData.type === 'pie' ? colors.slice(0, chartData.values.length) : 'rgba(99,102,241,0.8)', borderWidth: chartData.type === 'pie' ? 2 : 1, borderColor: chartData.type === 'pie' ? '#fff' : 'rgba(99,102,241,1)' }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: chartData.type === 'pie', position: 'right' } }, scales: chartData.type === 'bar' ? { y: { beginAtZero: true } } : {} }
            });
        }

        function openPinModal(question, query, columns, data) {
            currentPinData = { question, query, columns, data };
            document.getElementById('pin-title').value = question.substring(0, 50);
            document.getElementById('pin-modal').classList.add('show');
        }

        function closePinModal() {
            document.getElementById('pin-modal').classList.remove('show');
            currentPinData = null;
        }

        function confirmPin() {
            const dashboardName = document.getElementById('pin-dashboard-name').value.trim() || 'Main Dashboard';
            const title = document.getElementById('pin-title').value.trim() || currentPinData.question.substring(0, 50);

            if (!dashboards[dashboardName]) {
                dashboards[dashboardName] = [];
                addDashboardNav(dashboardName);
            }

            dashboards[dashboardName].push({
                id: 'pin-' + Date.now(),
                title: title,
                query: currentPinData.query,
                columns: currentPinData.columns,
                data: currentPinData.data,
                question: currentPinData.question
            });

            closePinModal();
            switchPanel('dashboard-' + dashboardName.toLowerCase().replace(/\s+/g, '-'));
        }

        function addDashboardNav(name) {
            const section = document.getElementById('dashboards-section');
            const panelId = 'dashboard-' + name.toLowerCase().replace(/\s+/g, '-');

            const navHtml = `<a class="nav-item" data-panel="${panelId}" id="nav-${panelId}" onclick="switchPanel('${panelId}')"><span class="nav-icon">üìä</span>${name}<span class="nav-item-remove" onclick="event.stopPropagation();removeDashboard('${name}')">√ó</span></a>`;
            section.insertAdjacentHTML('beforeend', navHtml);

            const panelHtml = `<div class="panel" id="panel-${panelId}"><div class="dashboard-grid" id="${panelId}-grid"></div></div>`;
            document.querySelector('.content-area').insertAdjacentHTML('beforeend', panelHtml);
        }

        function removeDashboard(name) {
            if (name === 'Main Dashboard') return;
            delete dashboards[name];
            const panelId = 'dashboard-' + name.toLowerCase().replace(/\s+/g, '-');
            document.getElementById(`nav-${panelId}`)?.remove();
            document.getElementById(`panel-${panelId}`)?.remove();
            switchPanel('query');
        }

        function renderDashboard(name) {
            const panelId = 'dashboard-' + name.toLowerCase().replace(/\s+/g, '-');
            const grid = document.getElementById(`${panelId}-grid`);
            const items = dashboards[name] || [];
            const emptyEl = document.getElementById('empty-dashboard');

            updateDashboardBadge(name, items.length);

            if (name === 'Main Dashboard') {
                if (items.length === 0) { emptyEl.style.display = 'block'; grid.style.display = 'none'; return; }
                emptyEl.style.display = 'none'; grid.style.display = 'grid';
            }

            grid.innerHTML = items.map(item => {
                const isSingleValue = item.data.length === 1 && item.columns.length === 1;
                const value = isSingleValue ? item.data[0][item.columns[0]] : null;

                if (isSingleValue && value !== null) {
                    return `<div class="dashboard-widget">
                        <button class="dashboard-widget-remove" onclick="removePinnedItem('${name}','${item.id}')">√ó</button>
                        <div class="dashboard-widget-value">${formatNumber(value)}</div>
                        <div class="dashboard-widget-label">${item.title}</div>
                    </div>`;
                }

                const chartData = analyzeForChart(item.question, item.columns, item.data);
                const chartId = chartData ? `dash-chart-${Date.now()}-${Math.random().toString(36).substr(2,9)}` : null;

                let content = `<div class="chat-table-wrapper"><table class="chat-table"><thead><tr>${item.columns.map(c => `<th>${c}</th>`).join('')}</tr></thead><tbody>${item.data.slice(0,10).map(r => `<tr>${item.columns.map(col => `<td>${r[col]||'-'}</td>`).join('')}</tr>`).join('')}</tbody></table></div>`;

                if (chartId) {
                    content += `<div class="chat-chart"><div class="chart-container"><canvas id="${chartId}"></canvas></div></div>`;
                    setTimeout(() => renderChart(chartId, chartData), 200);
                }

                return `<div class="dashboard-item"><div class="dashboard-item-header"><span class="dashboard-item-title">${item.title}</span><button class="btn btn-sm btn-secondary" onclick="removePinnedItem('${name}','${item.id}')">√ó</button></div><div class="dashboard-item-content">${content}</div></div>`;
            }).join('');
        }

        function formatNumber(val) {
            const num = parseFloat(val);
            if (isNaN(num)) return val;
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toLocaleString();
        }

        function updateDashboardBadge(name, count) {
            const panelId = 'dashboard-' + name.toLowerCase().replace(/\s+/g, '-');
            const navItem = document.getElementById(`nav-${panelId}`);
            if (!navItem) return;

            let badge = navItem.querySelector('.nav-count');
            if (count > 0) {
                if (!badge) {
                    badge = document.createElement('span');
                    badge.className = 'nav-count';
                    const removeBtn = navItem.querySelector('.nav-item-remove');
                    if (removeBtn) navItem.insertBefore(badge, removeBtn);
                    else navItem.appendChild(badge);
                }
                badge.textContent = count;
            } else if (badge) {
                badge.remove();
            }
        }

        function removePinnedItem(dashboardName, itemId) {
            dashboards[dashboardName] = dashboards[dashboardName].filter(i => i.id !== itemId);
            updateDashboardBadge(dashboardName, dashboards[dashboardName].length);
            renderDashboard(dashboardName);
        }

        async function autoConnect() {
            const defaultConnection = 'sqlite:///ecommerce.db';
            document.getElementById('connection-string').value = defaultConnection;
            try {
                const r = await fetch(`${API_BASE}/connect`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({connectionString: defaultConnection}),
                    credentials: 'include'
                });
                const d = await r.json();
                if (d.success) {
                    showStatus('connect-status', 'success', '‚úì Connected!');
                    updateConnectionStatus(true, d.dbType);
                    enableNav('explore'); enableNav('document'); enableNav('query');
                    document.getElementById('nav-dashboard-main').classList.remove('disabled');
                    document.getElementById('query-badge').style.display = 'inline';
                    switchPanel('query');
                } else {
                    switchPanel('connect');
                }
            } catch (e) {
                showStatus('connect-status', 'warning', '‚ö†Ô∏è Start backend first, then refresh');
                switchPanel('connect');
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            // Show landing page by default - don't auto-redirect to app
            showLoginScreen();
        });
        document.getElementById('connection-string').addEventListener('keypress', e => { if (e.key === 'Enter') connectDatabase(); });

        // Waitlist submission
        async function submitWaitlist(event) {
            event.preventDefault();
            const email = document.getElementById('waitlist-email').value.trim();
            const btn = document.getElementById('waitlist-btn');
            const btnText = document.getElementById('waitlist-btn-text');
            const spinner = document.getElementById('waitlist-spinner');
            const message = document.getElementById('waitlist-message');

            if (!email) return;

            // Show loading state
            btn.disabled = true;
            btnText.style.display = 'none';
            spinner.style.display = 'inline-block';
            message.textContent = '';
            message.className = 'waitlist-message';

            try {
                const response = await fetch(`${API_BASE}/waitlist`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                const data = await response.json();

                if (data.success) {
                    message.textContent = 'üéâ You\'re on the list! We\'ll be in touch soon.';
                    message.className = 'waitlist-message success';
                    document.getElementById('waitlist-email').value = '';
                } else {
                    message.textContent = data.error || 'Something went wrong. Please try again.';
                    message.className = 'waitlist-message error';
                }
            } catch (error) {
                message.textContent = 'Unable to connect. Please try again later.';
                message.className = 'waitlist-message error';
            } finally {
                btn.disabled = false;
                btnText.style.display = 'inline';
                spinner.style.display = 'none';
            }
        }
    </script>
</body>
</html>
